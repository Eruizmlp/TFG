<!doctype html>
<html lang="en-us">

<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>RayTracing In One Weekend (wgpuEngine)</title>
</head>

<body>
  <canvas class="emscripten" id="canvas" oncontextmenu="event.preventDefault()" tabindex=-1
    style="position:fixed;height:100%;width:100%;top:0%;left:0%;resize:both;"></canvas>
  <template id="main-script">
    {{{ SCRIPT }}}
  </template>
  <script type='text/javascript'>

    function loadApp() {
    }

    var Module = {
      preRun: [],
      postRun: [],
      canvas: (function () {
        var canvas = document.getElementById('canvas');

        // Event handler to resize the canvas when the document view is changed
        window.addEventListener('resize', () => {
          canvas.clientWidth = window.innerWidth;
          canvas.clientHeight = window.innerHeight;
          canvas.width = window.innerWidth;
          canvas.height = window.innerHeight;
        }, false);

        return canvas;
      })(),
      totalDependencies: 0
    };

    async function onEnginePreInitialized() {

        // await Promise.resolve( Module.Engine.getInstance() ).then( result => {

        //     if ( !result ) {
        //         console.error( "Module Instance is null" );
        //     }

        //     window.engineInstance = result;

        // } ).catch( error => {
        //     console.log( error );
        // });

        // Promise.resolve( window.engineInstance.setWasmModuleInitialized(true) ).then( 

        // ).catch( error => {
        //     console.log( error );
        // });

    }

    function onEngineInitialized()
    {
    }

    (async () => {
      // Custom for WebGPU
      if (!navigator.gpu) {
        console.error("Sorry, WebGPU is not suported by your browser.");
        return;
      } else {
        const jsTemplate = document.getElementById("main-script");
        const js = jsTemplate.content.cloneNode(true);
        document.body.appendChild(js);
      }
    })();
  </script>
</body>

</html>